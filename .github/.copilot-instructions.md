# Repo instructions

## C# coding guidelines

- Don't default to public. Least-exposure rule: private > internal > protected > public.
- Seal classes by default.
- If an interface has only one implementation, it should be in the same file as the implementation. Put the interface at the top of the file.
- Comments explain why, not what.
- Use XML doc comments for all types and public members.
- Use `<inheritdoc/>` for all implementations of interface members.
- Use record types for data classes.

### Async Programming Best Practices

- **Naming:** all async methods end with `Async` (incl. CLI handlers).
- **Always await:** no fire-and-forget; if timing out, **cancel the work**.
- **Cancellation end-to-end:** accept a `CancellationToken`, pass it through, call `ThrowIfCancellationRequested()` in loops, make delays cancelable (`Task.Delay(ms, ct)`).
- **Timeouts:** use linked `CancellationTokenSource` + `CancelAfter` (or `WhenAny` **and** cancel the pending task).
- **Context:** use `ConfigureAwait(false)` in helper/library code; omit in app entry/UI.
- **Stream JSON:** `GetAsync(..., ResponseHeadersRead)` → `ReadAsStreamAsync` → `JsonDocument.ParseAsync`; avoid `ReadAsStringAsync` when large.
- **Exit code on cancel:** return non-zero (e.g., `130`).
- **`ValueTask`:** use only when measured to help; default to `Task`.
- **Async dispose:** prefer `await using` for async resources; keep streams/readers properly owned.
- **No pointless wrappers:** don’t add `async/await` if you just return the task.
